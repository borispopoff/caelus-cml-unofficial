# -*- mode: python -*-
# Copyright (C) 2020 Applied CCM Pty Ltd

import os
import utils
from variables import caelus_vars, init_dependent_vars
from compiler import update_compiler_settings

### Initialize toolsets based on operating system
ostype = utils.ostype()
tools = ['default']
if ostype == 'windows':
    tools += ['mingw']

### Base SCons environment
env = Environment(variables = caelus_vars,
                  tools = tools,
                  ENV = os.environ)

init_dependent_vars(env)
update_compiler_settings(env)

### Isolate build environments based on build options
build_dir = os.path.join(
    Dir("#").abspath,"build",env['BUILD_OPTION'])

### Main Caelus entry points
sub_src = Split("""
    .
""")

for d in sub_src:
    SConscript('%s/SConscript'%d,
               exports=['env'],
               src_dir=Dir("#").srcnode().abspath,
               variant_dir=build_dir)

### Remove buid directory when cleaning
Clean(".", build_dir)
